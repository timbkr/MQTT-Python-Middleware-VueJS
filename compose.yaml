services:
  mosquitto:
    image: eclipse-mosquitto:2
    ports:
      - "1883:1883"
    volumes:
      - ./mqtt/mosquitto.conf:/mosquitto/config/mosquitto.conf:ro
      - mosq-data:/mosquitto/data
      - mosq-log:/mosquitto/log
    restart: unless-stopped

  middleware:
    build: .
    depends_on:
      - mosquitto
    ports:
      - "8080:8080"
    environment:
      # Im Container nutzt die App 'mosquitto'; lokal (ohne Compose) w√§re 'localhost'
      BROKER_HOST: mosquitto
      BROKER_PORT: 1883
      APP_PORT: 8080
      STATIC_DIR: /app/static
    restart: unless-stopped

volumes:
  mosq-data:
  mosq-log:
